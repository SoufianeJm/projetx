{% extends "billing/base.html" %}
{% load static %}

{% block title %}Resources{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Resources</h1>
    <form method="get" class="search-bar">
        <input type="text" 
               name="search" 
               class="search-input" 
               placeholder="Search by name, matricule, or grade..." 
               value="{{ search_query|default:'' }}">
        <button type="submit" class="btn btn-primary" title="Search">
            <i class="fas fa-search"></i>
        </button>
    </form>
    <a href="{% url 'resource_create' %}" class="btn btn-primary">
        <i class="fas fa-plus"></i>
        Add New Resource
    </a>
</div>

<div class="card">
    {% if resources %}
    <table class="table-modern">
        <thead>
            <tr>
                <th style="width: 60px">Picture</th>
                <th>Full Name</th>
                <th>Matricule</th>
                <th>Grade</th>
                <th>Grade Description</th>
                <th style="width: 60px">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for resource in resources %}
            <tr>
                <td>
                    {% if resource.picture %}
                        <div class="avatar">
                            <img src="{{ resource.picture.url }}" alt="{{ resource.full_name }}">
                        </div>
                    {% else %}
                        <div class="avatar">
                            {% if resource.full_name %}
                                {{ resource.full_name|slice:":1"|upper }}
                            {% else %}
                                <i class="fas fa-user"></i>
                            {% endif %}
                        </div>
                    {% endif %}
                </td>
                <td>{{ resource.full_name }}</td>
                <td>{{ resource.matricule }}</td>
                <td>{{ resource.grade }}</td>
                <td>{{ resource.grade_des }}</td>
                <td class="actions-cell">
                    <div class="action-menu">
                        <button type="button" class="action-trigger" onclick="toggleActionMenu('{{ forloop.counter }}')">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                        <div class="action-menu-items" id="action-menu-{{ forloop.counter }}">
                            <a href="{% url 'resource_update' resource.pk %}" class="action-menu-item">
                                <i class="fas fa-edit"></i> Edit
                            </a>
                            <a href="{% url 'resource_delete' resource.pk %}" class="action-menu-item delete">
                                <i class="fas fa-trash"></i> Delete
                            </a>
                        </div>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-state">
        <p>No resources currently listed.</p>
        <a href="{% url 'resource_create' %}" class="btn btn-primary">
            <i class="fas fa-plus"></i>
            Add New Resource
        </a>
    </div>
    {% endif %}
</div>

<script>
function toggleActionMenu(id) {
    // Close all other menus
    document.querySelectorAll('.action-menu-items').forEach(menu => {
        if (menu.id !== `action-menu-${id}`) {
            menu.classList.remove('show');
        }
    });
    
    // Toggle the clicked menu
    const menu = document.getElementById(`action-menu-${id}`);
    menu.classList.toggle('show');
}

// Close menus when clicking outside
document.addEventListener('click', function(event) {
    if (!event.target.closest('.action-menu')) {
        document.querySelectorAll('.action-menu-items').forEach(menu => {
            menu.classList.remove('show');
        });
    }
});
</script>
{% endblock %} 